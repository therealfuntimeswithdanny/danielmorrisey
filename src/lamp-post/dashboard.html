<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard - AI Image Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">

<header class="flex justify-between items-center p-4 bg-gray-800 shadow">
  <h1 class="text-xl font-bold">My Dashboard</h1>
  <button id="logoutBtn" class="px-3 py-1 bg-red-500 rounded hover:bg-red-600">Logout</button>
</header>

<main class="flex-1 p-6">
  <h2 class="text-lg mb-4">Your Generated Images</h2>
  <div id="gallery" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
</main>

<script>
const API_BASE = "https://lamp-post.madebydannyuk.workers.dev";

async function fetchHistory() {
  try {
    const res = await fetch(`${API_BASE}/api/history`);
    if(res.status === 401){
      alert("Please login first");
      window.location.href = "login.html";
      return;
    }
    const data = await res.json();
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";

    data.images.reverse().forEach(img => {
      const div = document.createElement("div");
      div.className = "bg-gray-800 rounded-xl p-2 flex flex-col items-center shadow";
      div.innerHTML = `
        <img src="${img.imrs}" class="rounded-xl mb-2 w-full" />
        <p class="text-sm break-words text-center mb-1">${img.prompt}</p>
        <a href="${img.url}" target="_blank" class="px-2 py-1 bg-green-500 rounded hover:bg-green-600 text-xs">Download</a>
      `;
      gallery.appendChild(div);
    });
  } catch(err){
    console.error(err);
    alert("Failed to load history");
  }
}

document.getElementById("logoutBtn").addEventListener("click", async () => {
  try {
    await fetch(`${API_BASE}/api/logout`, { method: "POST" });
    window.location.href = "login.html";
  } catch(err){
    console.error(err);
  }
});

fetchHistory();
</script>
</body>
</html>
