<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Follow on Bluesky</title>
  <meta name="description" content="Quick profile card to open an AT Protocol (Bluesky) profile in multiple clients." />
  <meta name="robots" content="index, follow" />

  <style>
    :root{
      --bg:#0d0d0d;
      --card:#141414;
      --muted:#bdbdbd;
      --accent:#0070f3;
      --glass:rgba(255,255,255,0.02);
      --radius:14px;
      --maxw:360px;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      background:linear-gradient(180deg,var(--bg),#050505);
      color:#f7f7f7;
    }

    .card{
      width:100%;
      max-width:var(--maxw);
      background:linear-gradient(180deg,var(--card),#0f0f0f);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      text-align:center;
      transition:transform .14s ease,box-shadow .14s ease;
    }
    .card:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(0,0,0,0.7)}

    .profile{
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:center;
      flex-direction:column;
    }
    .avatar{
      width:86px;height:86px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid var(--accent);
      background:linear-gradient(180deg,#222,#0a0a0a);
    }
    .name{margin:8px 0 0;font-size:1.05rem;font-weight:600}
    .tagline{margin:6px 0 0;color:var(--muted);font-size:.9rem}

    .links{
      margin-top:18px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }
    .link{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px;
      border-radius:10px;
      text-decoration:none;
      background:var(--glass);
      color:inherit;
      transition:transform .12s ease,box-shadow .12s ease,background .12s ease,color .12s ease;
    }
    .link img{width:28px;height:28px;border-radius:6px;flex:0 0 28px}
    .link .label{font-weight:600;font-size:.95rem}
    .link:hover{transform:translateY(-4px);background:#fff}

    /* Brand hover colors */
    .link.bsky:hover{color:#1083fd;background:black;box-shadow:0 0 12px rgb(14, 118, 255)}
    .link.deer:hover{color:#749f7a;background:rgb(0, 0, 0);box-shadow:0 0 12px rgb(97,255,134,0.4)}
    .link.catsky:hover{color:#cca6f7;background:#000;box-shadow:0 0 12px rgba(204,166,247,1)}
    .link.blacksky:hover{color:#000000;background:#ffffff;box-shadow:0 0 12px rgb(255, 255, 255)}
    .link.anisota:hover{color:#c28431;background:#000;box-shadow:0 0 12px rgba(255,69,0,0.4)}
    .link.tangled:hover{color:white;background:black;box-shadow:0 0 12px rgba(255, 255, 255, 0.4)}
    .link.nooki:hover{color:#FDC417;background:black;box-shadow:0 0 12px rgba(253, 196, 23, 1)}

    .controls{
      margin-top:16px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .control-row{display:flex;gap:8px;align-items:center}
    .control-row input{
      flex:1;
      padding:9px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      outline:none;
    }
    .control-row button{
      padding:9px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      background:var(--accent);
      color:white;
      font-weight:600;
    }

    .meta{
      margin-top:16px;
      font-size:13px;
      color:var(--muted);
      text-align:left;
    }
    .meta a{color:var(--accent);text-decoration:none}
    .meta a:hover{text-decoration:underline}

    @media(max-width:380px){
      :root{--maxw:100%}
      .links{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="displayName">
    <section class="profile" aria-live="polite">
      <img id="avatar" class="avatar" src="" alt="Profile avatar" />
      <h2 id="displayName" class="name">Loading…</h2>
      <div id="tagline" class="tagline"></div>
    </section>

    <nav id="links" class="links" aria-label="Open in client"></nav>

    <section class="controls" aria-label="Actions">
      <div class="control-row">
        <input id="try-handle" type="text" placeholder="yourhandle.com or did:plc:..." aria-label="Try with your profile" />
        <button id="try-button" type="button">Try</button>
      </div>
      <div class="control-row">
        <input id="custom-client" type="url" placeholder="https://client.example" aria-label="Custom client base URL" />
        <button id="custom-open" type="button">Open</button>
      </div>
    </section>

    <p class="meta" style="text-align: center;">
      by <a href="/followonbsky.html?did=did:plc:l37td5yhxl2irrzrgvei4qay">@madebydanny.uk</a>,
      add a client <a href="https://tally.so/r/nrzQDl" target="_blank" rel="noopener">here</a>
    </p>
  </main>

  <script>
    (function () {
      const clients = [
        { name: "Bluesky", base: "https://bsky.app/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/followonbluesky/bsky.png", cls: "bsky" },
        { name: "Deer Social", base: "https://deer.social/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/followonbluesky/deer-social.png", cls: "deer" },
        { name: "Catsky", base: "https://catsky.social/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/followonbluesky/catsky.png", cls: "catsky" },
        { name: "Blacksky", base: "https://blacksky.community/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/followonbluesky/black-sky.png", cls: "blacksky" },
        { name: "anisota", base: "https://anisota.net/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/user-content/2025-10-11/1760219737665_bafkreico43sttmdhwk5vu5veou3bu6amu3s2cgvvqwpav6mrnpv5gz5icq.jpg", cls: "anisota" },
        { name: "Deer (ayla fork)", base: "https://deer.aylac.top/profile/", icon: "https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/user-content/2025-10-11/1760222708511_bafkreihiorp2tzyfjovyne3pv6tsxdy4vilfunodi7z2u4fancgvyo25xe.jpg", cls: "deer" },
        { name: "Tangled", base: "https://tangled.org/", icon: "https://imrs.madebydanny.uk/?url=https%3A%2F%2Fcdn.madebydanny.uk%2Fuser-content%2F2025-10-19%2F1760916775018_did%20plc%20wshs7t2adsemcrrd4snkeqli%20avatar.jpeg", cls: "tangled" },
        { name: "SkySpace", base: "https://skyspace.me/?", icon: "https://imrs.madebydanny.uk/?url=https%3A%2F%2Fcdn.madebydanny.uk%2Fuser-content%2F2025-10-20%2F1760974273575_SkySpace%20Deer.jpg", cls: "bsky" },
        { name: "Nooki", base: "https://nooki.me/user/", icon: "https://imrs.madebydanny.uk/?url=https%3A%2F%2Fcdn.madebydanny.uk%2Fuser-content%2F2025-10-22%2F1761176257906_Nooki%20512x512.png", cls: "nooki" }
      ];

      const avatarEl = document.getElementById('avatar');
      const nameEl = document.getElementById('displayName');
      const tagEl = document.getElementById('tagline');
      const linksRoot = document.getElementById('links');
      const tryInput = document.getElementById('try-handle');
      const tryBtn = document.getElementById('try-button');
      const customInput = document.getElementById('custom-client');
      const customBtn = document.getElementById('custom-open');

      function setText(el, txt){ el.textContent = txt ?? ''; }

      function makeClientLink(c, handle){
        const a = document.createElement('a');
        a.className = 'link ' + (c.cls || '');
        a.href = c.base + encodeURIComponent(handle);
        a.target = '_blank';
        a.rel = 'noopener';
        a.setAttribute('aria-label', `Open ${c.name} for ${handle}`);

        const img = document.createElement('img');
        img.src = c.icon;
        img.alt = c.name + ' icon';
        img.loading = 'lazy';

        const span = document.createElement('span');
        span.className = 'label';
        span.textContent = c.name;

        a.append(img, span);
        return a;
      }

      function openCustom(handle){
        let url = (customInput.value || '').trim();
        if(!url)return;
        if(!/^https?:\/\//i.test(url))url='https://'+url;
        url=url.replace(/\/+$/,'')+'/profile/'+encodeURIComponent(handle);
        window.open(url,'_blank','noopener');
      }

      // ✅ Improved DID/handle entry support
      function tryProfile() {
        let value = (tryInput.value || '').trim();
        if (!value) return;

        // Strip leading @
        if (value.startsWith('@')) value = value.slice(1);

        // Extract handle from URLs like https://bsky.app/profile/handle
        try {
          const parsed = new URL(value);
          const parts = parsed.pathname.split('/').filter(Boolean);
          if (parts.length && (parts[0] === 'profile' || parts[0] === 'actor')) {
            value = parts[1];
          }
        } catch (_) { /* not a URL */ }

        // Update query param and reload
        const u = new URL(location.href);
        u.searchParams.set('did', value);
        location.href = u.toString();
      }

      async function loadProfile(){
        const params=new URLSearchParams(location.search);
        const did=params.get('did');
        if(!did){
          setText(nameEl,'Missing ?did=');
          setText(tagEl,'Add a DID or handle to view a profile.');
          tryBtn.onclick=tryProfile;
          tryInput.onkeydown=e=>{if(e.key==='Enter')tryProfile()};
          return;
        }
        try{
          const res=await fetch(`https://public.api.bsky.app/xrpc/app.bsky.actor.getProfile?actor=${encodeURIComponent(did)}`);
          if(!res.ok)throw new Error('fetch failed');
          const data=await res.json();
          const handle=data.handle||did;
          const avatar=data.avatar?`https://imrs.madebydanny.uk?url=${encodeURIComponent(data.avatar)}`:'https://imrs.madebydanny.uk/?url=https://public-cdn.madebydanny.uk/user-content/2025-10-11/1760220038748_cloudflare-brands-solid-full.svg';

          avatarEl.src=avatar;
          avatarEl.alt=`${data.displayName||handle} avatar`;
          setText(nameEl,data.displayName||handle);
          setText(tagEl,`@${handle} is on the AT Protocol — pick a client to follow them!`);

          linksRoot.innerHTML='';
          clients.forEach(c=>linksRoot.appendChild(makeClientLink(c,handle)));

          customBtn.onclick=()=>openCustom(handle);
          customInput.onkeydown=e=>{if(e.key==='Enter')openCustom(handle)};
          tryBtn.onclick=tryProfile;
          tryInput.onkeydown=e=>{if(e.key==='Enter')tryProfile()};
        }catch(e){
          nameEl.textContent='Error loading profile';
          tagEl.textContent='Check your DID or try again.';
          linksRoot.innerHTML='';
          tryBtn.onclick=tryProfile;
          tryInput.onkeydown=e=>{if(e.key==='Enter')tryProfile()};
        }
      }

      document.addEventListener('DOMContentLoaded',loadProfile);
    })();
  </script>
</body>
</html>
